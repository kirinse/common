define("kirin/common/1.0.0/common",["popup","jquery","overlay","position","iframe-shim","widget","base","./count","./message","templatable","handlebars","./account","xbox","mask","./birthday","swfobject","cookie","./robot"],function(a,b,c){c.exports.Count=a("./count"),c.exports.Message=a("./message"),c.exports.Account=a("./account"),c.exports.Birthday=a("./birthday"),c.exports.Robot=a("./robot"),c.exports.Dropdown=a("./dropdown")}),define("kirin/common/1.0.0/count",["jquery"],function(a,b,c){function d(){return e||(e=f('<span class="global-toplink-msgCount"></span>').addClass("fn-hide").appendTo(g)),e}var e,f=a("jquery"),g=f("#global-header-msg .global-toplink-msg"),h={count:0,setCount:function(a){this.count=a,a>99&&(a="99+"),0==a?g.removeClass("global-toplink-msg-active"):g.addClass("global-toplink-msg-active"),d().html(a).removeClass("fn-hide")},getCount:function(){return this.count},hideCount:function(){g.removeClass("global-toplink-msg-active"),d().addClass("fn-hide")}};c.exports=h}),define("kirin/common/1.0.0/message",["jquery","templatable","handlebars","kirin/common/1.0.0/dropdown","popup","overlay","position","iframe-shim","widget","base","kirin/common/1.0.0/count"],function(a,b,c){function d(a){h.ajax(p.getmessage,{dataType:"jsonp"}).success(function(b){if("ok"===b.stat){var c=parseInt(b.totalCount,10);m.setCount(c),a(b)}else m.hideCount()})}function e(a){return a.sort(function(a,b){return b.level-a.level})}function f(a){var b=0,c={infos:e(a.infos)},d=k.compile('{{#infos}}<li class="{{messageClass}} global-list-level{{level}}" data-id="{{id}}" data-level="{{level}}">{{{messageContent this}}}<a href="javascript:void(0);" class="global-list-close" seed="global-msg-close">X</a></li>{{/infos}}');return k.registerHelper("messageClass",function(){return b++>=3?"fn-hide":""}),k.registerHelper("messageContent",function(a){var b=a.url,c=a.content.length>46?a.content.replace(/^(.{43}).*$/,"$1..."):a.content;return/^(http|https)/i.test(b)?(b=p.redirecturl+"?msgId="+a.id+"&url="+b,'<a href="'+b+'" target="_blank" class="global-list-msg-content" seed="global-msg-item">'+c+"</a>"):'<span class="global-list-msg-content">'+c+"</span>"}),d(c)}function g(a){var b=this.$(".global-toplink-msgCount"),c=this.$("#global-list-msg"),d=c.children().length;b.html(d-1),m.setCount(d-1),d>3&&c.children(".fn-hide:first").removeClass("fn-hide"),h(a).parent().hide(400,"swing",function(){h(this).remove()})}var h=a("jquery"),i=a("templatable"),j=a("kirin/common/1.0.0/dropdown"),k=a("handlebars"),l=a("position"),m=a("kirin/common/1.0.0/count"),n=window.GLOBAL||{},o=!1,p={redirecturl:n.system.personal+"/user/msgcenter/modifyStatusAndRedirect.htm",getmessage:n.system.personal+"/user/msgcenter/getMsgInfosNew.json?_callback=?",popmessage:n.system.personal+"/user/msgcenter/popMsgInfos.json?_callback=?",readmessage:n.system.personal+"/user/msgcenter/readMsg.json?_callback=?&historySource=I&msgIds="},q=j.extend({Implements:i,Statics:{getMessageCount:d},events:{"click #global-msg-isee":"markAllRead","click #global-list-msg a.global-list-msg-content":function(a){g.call(this,a.currentTarget)},"click #global-list-msg a.global-list-close":"markRead","click #global-msg-confirm-ok":"confirmOk","click #global-msg-confirm-cancel":"confirmCancel","mouseenter .global-list li":function(a){h(a.currentTarget).addClass("global-list-hover")},"mouseleave .global-list li":function(a){h(a.currentTarget).removeClass("global-list-hover")}},show:function(){var a=this;return o||h.ajax(p.popmessage,{dataType:"jsonp"}).success(function(b){"ok"===b.stat&&(m.setCount(b.totalCount),a.renderMsg(b))}),m.getCount()>0?q.superclass.show.call(this):this},renderMsg:function(a){return o||(this.$(".global-toplink-msgCount").html(a.totalCount),this.$("#global-list-msg").html(f(a)).removeClass("global-loading"),o=!0),this},markAllRead:function(a){a.preventDefault(),m.setCount(0);var b=this.$("#global-list-msg li").map(function(){return h(this).attr("data-id")}).get().join(",");this.hide(),this.$("#global-list-msg").html(),h.ajax(p.readmessage+b,{dataType:"jsonp"})},markRead:function(a){var b=a.currentTarget,c=h(b).parent(),d=this.$("#global-msg-confirm"),e=c.attr("data-id");this.currentConfirmMsg&&(h(this.currentConfirmMsg).parent().css("height","auto"),this.currentConfirmMsg=null),3==c.attr("data-level")?(this.currentConfirmMsg=b,c.css("height",d.height()-16),d.show(),l.pin(d[0],c[0])):(d.hide(),g.call(this,b),h.ajax(p.readmessage+e,{dataType:"jsonp"}))},confirmOk:function(a){a.preventDefault();var b=h(this.currentConfirmMsg).parent().attr("data-id");this.$("#global-msg-confirm").hide(),g.call(this,this.currentConfirmMsg),h.ajax(p.readmessage+b,{dataType:"jsonp"})},confirmCancel:function(a){a.preventDefault(),h(this.currentConfirmMsg).parent().css("height","auto"),this.currentConfirmMsg=null,this.$("#global-msg-confirm").hide()}});c.exports=q}),define("kirin/common/1.0.0/account",["jquery","kirin/common/1.0.0/dropdown","popup","overlay","position","iframe-shim","widget","base","handlebars","xbox","mask"],function(a,b,c){function d(a){a=a.replace(/^\s*(.*?)\s*$/g,"$1");var b={regxp:/(^.*)(.{3}$)/g,placeholder:"$1...",leftLimit:11,rightLimit:7,totalLimit:19},c=a.split("@"),d=c[0],e=c[1];return c.length>1&&a.length>b.totalLimit?(d.length>b.leftLimit&&(d=d.slice(0,b.leftLimit).replace(b.regxp,b.placeholder)),e.length>b.rightLimit&&(e=e.slice(0,b.rightLimit).replace(b.regxp,b.placeholder)),[d,"@",e].join("").toLowerCase()):a.toLowerCase()}function e(a){if(a&&a.outerWidth()>147){var b=a.html(),c=d(b);c.length===b.length&&(c=c.slice(0,10)+"..."),a.html(c)}}function f(){return p||(p=new k({type:"iframe",classPrefix:"global-xbox",isOld:!0,height:"300px"}).render()),p}function g(a,b){var c=0;j.registerHelper("accountContent",function(){var a=d(this),b=n.loginurl+this;return c++<10?'<li><a href="'+b+'" class="global-xbox-item" target="_blank" title="'+this+'">'+a+"</a></li>":void 0});var e=j.compile("{{#accts}}{{{accountContent}}}{{/accts}}");b.html(e(a)).removeClass("global-loading")}var h=a("jquery"),i=a("kirin/common/1.0.0/dropdown"),j=a("handlebars"),k=a("xbox"),l=!1,m=window.GLOBAL||{},n={loginurl:m.system.authcenter+"/login/xbox.htm?loginScene=x&change=true&logonId=",accounturl:m.system.personal+"/home/statusbar/getRelativeAccounts.json?_callback=?"},o=i.extend({events:{"click .global-xbox-item":"changeLogin"},setup:function(){o.superclass.setup.call(this);var a=this.$("#global-username");a.html(d(a.html())),e(this.get("trigger").find("#global-toplink-username"))},show:function(){var a=this.$("#global-users");return"true"!==a.attr("data-user")||l||(l=!0,h.ajax(n.accounturl,{dataType:"jsonp"}).success(function(b){return"ok"!=b.stat?(l=!1,a.hide(),void 0):(l=!0,g(b,a.find("#global-list-user")),void 0)}).error(function(){l=!1,a.hide()})),o.superclass.show.call(this)},changeLogin:function(a){a.preventDefault(),f().set("content",a.currentTarget.href).show()}});c.exports=o;var p}),define("kirin/common/1.0.0/birthday",["jquery","widget","base","swfobject","cookie"],function(a,b,c){function d(){var a=i.today,b={"01":"20","02":"19","03":"21","04":"21","05":"21","06":"22","07":"23","08":"23","09":"23",10:"23",11:"22",12:"22"},c=a.slice(-4,-2),d=a.slice(-2);return Number(d)<Number(b[c])&&(c=Number(c)-1,0==c&&(c=12)),/^\d{2}$/.test(c)?c+"":"0"+c}function e(){return i.birthday&&i.today.slice(4)===i.birthday}a("jquery");var f=a("widget"),g=a("swfobject"),h=a("cookie"),i=window.GLOBAL||{},j=f.extend({param:{param:d(),mode:1},Statics:{isBirthday:e()},events:{"hover .global-birth-icon":"toggleTip","click .global-birth-icon":function(a){a.preventDefault(),this.showFlash(1)}},setup:function(){this.firstShow()},toggleTip:function(a){"mouseenter"==a.type?this.$(".global-birth-tip").show():this.$(".global-birth-tip").hide()},showFlash:function(a){var b=this.$("#global-birthSwf");if(!b.hasClass("global-swfObj")){this.param.mode=a,b.addClass("global-swfObj");var c={wmode:"transparent",allowFullscreen:"true",allowScriptAccess:"always"};g.embedSWF(i.BIRTHURL+"?t="+(new Date).getTime(),"global-swfObj","350","300","9.0.0","expressInstall.swf",{},c)}},hideFlash:function(){var a=this.$("#global-birthSwf");a.hasClass("global-swfObj")&&a.removeClass("global-swfObj").html('<div id="global-swfObj"></div>')},firstShow:function(){var a=h.get("global-birthshow");a||(this.$(".global-birth-tip").show(),h.set("global-birthshow","true",{expires:1,path:"/"}))}});c.exports=j}),define("kirin/common/1.0.0/robot",["jquery","templatable","handlebars","kirin/common/1.0.0/dropdown","popup","overlay","position","iframe-shim","widget","base"],function(a,b,c){function d(a){var b=0;return a.isComplete&&(b+=20),a.isBindedMobile&&(b+=20),a.isCertified&&(b+=20),3==a.questions&&(b+=20),"T"==a.activedEmail&&(b+=20),b}var e=a("jquery"),f=a("templatable"),g=a("kirin/common/1.0.0/dropdown"),h=a("handlebars"),i=!1,j=window.GLOBAL||{},k={roboturl:j.system.personalportal+"/portal/robot/getRobotData.json?_callback=?"},l=g.extend({Implements:f,templateHelpers:{securityContent:function(){return"LOW"===this.securityLevel?new h.SafeString('<span class="global-robot-red">低</span>'):"MEDIUM"===this.securityLevel?new h.SafeString('<span class="global-robot-red">中</span>'):"HIGH"===this.securityLevel?"高":"MAX"===this.securityLevel?"极高":void 0},securityPercent:function(){var a=0;return this.isBindedMobile&&(a+=40),("HIGH"===this.securityLevel||"MAX"===this.securityLevel)&&(a+=60),(a||"2")+"%"},convenientContent:function(){return this.fpCount>0?"快":new h.SafeString('<span class="global-robot-red">慢</span>')},convenientPercent:function(){return this.fpCount>0?"100%":"2%"},completeContent:function(){var a=d(this);return 40>=a?new h.SafeString('<span class="global-robot-red">'+a+"%</span>"):(a||"2")+"%"},completePercent:function(){return d(this)+"%"},robotPart:function(a){var b=a.split("-")[0],c="global-robot-"+a;switch(b){case"head":this.isComplete&&(c+=" global-robot-"+a+"-active");break;case"ear":this.isBindedMobile&&(c+=" global-robot-"+a+"-active");break;case"arm":case"leg":this.fpCount>0&&(c+=" global-robot-"+a+"-active");break;case"body":("HIGH"===this.securityLevel||"MAX"===this.securityLevel)&&(c+=" global-robot-"+a+"-active");break;case"heart":this.isCertified&&(c+=" global-robot-"+a+"-active")}return c}},model:{loading:!0},initAttrs:function(a){l.superclass.initAttrs.call(this,a),this.model.isLogin||(this.model.loading=!1,i=!0)},show:function(){var a=this;return i||(i=!0,e.ajax(k.roboturl,{dataType:"jsonp"}).success(function(b){return"ok"!=b.stat?(l.superclass.show.call(a),i=!1,void 0):(i=!0,e.extend(a.model,{isSuccess:!0},b),a.renderPartial(".global-robot"),void 0)}).error(function(){i=!1})),l.superclass.show.call(a),this}});c.exports=l});
