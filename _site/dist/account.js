define("kirin/common/1.0.0/account",["jquery/jquery/1.7.2/jquery","./dropdown","arale/popup/1.1.6/popup","$","arale/overlay/1.1.4/overlay","arale/position/1.0.1/position","arale/iframe-shim/1.0.2/iframe-shim","arale/widget/1.1.1/widget","arale/base/1.1.1/base","arale/class/1.1.0/class","arale/events/1.1.0/events","gallery/handlebars/1.0.2/handlebars","alipay/xbox/1.0.3/xbox","arale/dialog/1.0.1/dialog","arale/overlay/1.0.1/overlay","arale/position/1.0.0/position","arale/iframe-shim/1.0.1/iframe-shim","arale/widget/1.0.3/widget","arale/base/1.0.1/base","arale/class/1.0.0/class","arale/events/1.0.0/events","arale/overlay/1.0.1/mask","arale/widget/1.0.3/templatable","gallery/handlebars/1.0.0/handlebars","alipay/object-shim/1.0.0/object-shim"],function(a,b,c){function d(a){a=a.replace(/^\s*(.*?)\s*$/g,"$1");var b={regxp:/(^.*)(.{3}$)/g,placeholder:"$1...",leftLimit:11,rightLimit:7,totalLimit:19},c=a.split("@"),d=c[0],e=c[1];return c.length>1&&a.length>b.totalLimit?(d.length>b.leftLimit&&(d=d.slice(0,b.leftLimit).replace(b.regxp,b.placeholder)),e.length>b.rightLimit&&(e=e.slice(0,b.rightLimit).replace(b.regxp,b.placeholder)),[d,"@",e].join("").toLowerCase()):a.toLowerCase()}function e(a){if(a&&a.outerWidth()>147){var b=a.html(),c=d(b);c.length===b.length&&(c=c.slice(0,10)+"..."),a.html(c)}}function f(){return p||(p=new k({width:720}).render()),p}function g(a,b){var c=0;j.registerHelper("accountContent",function(){var a=d(this),b=n.loginurl+this;return c++<10?'<li><a href="'+b+'" class="global-xbox-item" target="_blank" title="'+this+'">'+a+"</a></li>":void 0});var e=j.compile("{{#accts}}{{{accountContent}}}{{/accts}}");b.html(e(a)).removeClass("global-loading")}var h=a("jquery/jquery/1.7.2/jquery"),i=a("./dropdown"),j=a("gallery/handlebars/1.0.2/handlebars"),k=a("alipay/xbox/1.0.3/xbox"),l=!1,m=window.GLOBAL||{},n={loginurl:m.system.authcenter+"/login/xbox.htm?loginScene=x&change=true&logonId=",accounturl:m.system.personal+"/home/statusbar/getRelativeAccounts.json?_callback=?"},o=i.extend({events:{"click .global-xbox-item":"changeLogin"},setup:function(){o.superclass.setup.call(this);var a=this.$("#global-username");a.html(d(a.html())),e(this.get("trigger").find("#global-toplink-username"))},show:function(){var a=this.$("#global-users");return"true"!==a.attr("data-user")||l||(l=!0,h.ajax(n.accounturl,{dataType:"json"}).success(function(b){return"ok"!=b.stat?(l=!1,a.hide(),void 0):(l=!0,g(b,a.find("#global-list-user")),void 0)}).error(function(){l=!1,a.hide()})),o.superclass.show.call(this)},changeLogin:function(a){a.preventDefault(),f().set("content",a.currentTarget.href).show()}});c.exports=o;var p}),define("kirin/common/1.0.0/dropdown",["arale/popup/1.1.6/popup","$","arale/overlay/1.1.4/overlay","arale/position/1.0.1/position","arale/iframe-shim/1.0.2/iframe-shim","arale/widget/1.1.1/widget","arale/base/1.1.1/base","arale/class/1.1.0/class","arale/events/1.1.0/events"],function(a,b,c){var d=a("arale/popup/1.1.6/popup"),e=d.extend({setup:function(){e.superclass.setup.call(this),this._tweakAlignDefaultValue()},_tweakAlignDefaultValue:function(){var a=this.get("align");a.baseXY.toString()===[0,0].toString()&&(a.baseXY=[0,"100%"]),"VIEWPORT"===a.baseElement._id&&(a.baseElement=this.get("trigger")),this.set("align",a)}});c.exports=e});
